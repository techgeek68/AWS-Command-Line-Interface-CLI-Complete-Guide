# AWS CLI â€” EC2 Security Group Operations

> Note: When running commands or instructions in PowerShell, do not forget to use aws.exe
---
**Get first VPC ID (bash)**

Syntax/Example:
```bash
  VPC_ID=$(aws ec2 describe-vpcs --query "Vpcs[0].VpcId" --output text)
```

**Show VPC_ID (bash)**

Syntax/Example:
```bash
  echo "$VPC_ID"
```

**Get first VPC ID (PowerShell)**

Syntax/Example:
```powershell
  $VPC_ID = (aws.exe ec2 describe-vpcs --query "Vpcs[0].VpcId" --output text)
```

**Show VPC_ID (PowerShell)**

Syntax/Example:
```powershell
  $VPC_ID
```

**Create security group (bash)**

Syntax:
```bash
  SG_JSON=$(aws ec2 create-security-group --group-name <SECURITY_GROUP_NAME> --description "<DESCRIPTION>" --vpc-id $VPC_ID)
```

**Extract security group ID (bash)**:

To store the GroupId in a variable:
```bash
  SG_ID=$(echo "$SG_JSON" | jq -r '.GroupId')
```

**Create security group (PowerShell)**

Syntax:
```powershell
$sgCreate = aws.exe ec2 create-security-group --group-name <SECURITY_GROUP_NAME> --description "<DESCRIPTION>" --vpc-id $VPC_ID --output json
```
Example:
```powershell
$sgCreate = aws.exe ec2 create-security-group --group-name MyWebSecurity --description "Allowing HTTP Access" --vpc-id $VPC_ID --output json
```

**Extract security group ID (PowerShell)**

To store the GroupId in a variable:
```powershell
  $SG_ID = ($sgCreate | ConvertFrom-Json).GroupId
```

**Authorize SSH ingress**

```bash
  aws ec2 authorize-security-group-ingress --group-id <SECURITY_GROUP_ID> --protocol tcp --port 22 --cidr 0.0.0.0/0
```


**Authorize HTTP ingress**

Linux/Unix
```bash
  aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port 80 --cidr 0.0.0.0/0
```
PowerShell:
```powershell
aws.exe ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port 80 --cidr 0.0.0.0/0
```

**Authorize MySQL ingress (single IP)**

Linux/Unix
```bash
  aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port 3306 --cidr <PUBLIC_IP>/32
```
PowerShell:
```powershell
  aws.exe ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port 3306 --cidr <PUBLIC_IP>/32
```

**Authorize SMTP IPv4**

```bash
  aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port 25 --cidr 0.0.0.0/0
```

**Authorize SMTP IPv6**

```bash
  aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol tcp --port 25 --cidr ::/0
```

**Allow ALL traffic (NOT recommended)**

```bash
  aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol -1 --port -1 --cidr 0.0.0.0/0
```
```powershell
  aws ec2 authorize-security-group-ingress --group-id $SG_ID --protocol -1 --port -1 --cidr 0.0.0.0/0
```

**List security group**

Syntax:
```bash
  aws ec2 describe-security-groups --group-ids <SECURITY_GROUP_ID>
```

Examples:
```bash
  aws ec2 delete-security-group --group-id
```

Examples:
```bash
  aws ec2 delete-security-group --group-id $SG_ID
```

**Revoke SSH ingress**
Syntax:
```bash
  aws ec2 revoke-security-group-ingress --group-id <SECURITY_GROUP_ID> --protocol tcp --port 22 --cidr 0.0.0.0/0
```
Example:
```bash
  aws ec2 revoke-security-group-ingress --group-id $SG_ID --protocol tcp --port 22 --cidr 0.0.0.0/0
```
Follow a similar process for other services.

## Delete security group
Syntax:
```bash
  aws ec2 delete-security-group --group-id <SECURITY_GROUP_ID>
```

```bash
  aws ec2 delete-security-group --group-id $SG_ID
```
---
