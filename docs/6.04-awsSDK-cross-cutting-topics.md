# AWS SDK Developer Guide — Cross-Cutting Topics

> Covers credential management, STS role assumption, pagination/waiters patterns across SDKs, retries & backoff strategies, logging, instrumentation, testing & local dev, common errors, and universal best practices.

## Table of Contents
1. Credential Strategies
2. STS & Temporary Credentials
3. Pagination Patterns
4. Waiters & State Polling
5. Retry Modes & Backoff
6. Timeouts & Resilience
7. Logging & Observability
8. Testing & Local Development
9. Common Errors (Mapping)
10. Universal Best Practices
11. Security Checklist

---

## 1. Credential Strategies
Hierarchy (typical):
1. Environment variables
2. Shared credentials/profile (`~/.aws/credentials`)
3. SSO cached tokens
4. Web identity / OIDC (EKS)
5. Instance/container metadata (role)
6. Custom credential provider chain

Rotate credentials regularly, prefer ephemeral (role-based) credentials.

---

## 2. STS & Temporary Credentials
Advantages:
- Automatic expiration
- Minimized blast radius
- Policy-scoped session

Common flow:
1. Base profile has permission to assume the target role.
2. SDK assumes role on-demand or via shared config with `role_arn`.

---

## 3. Pagination Patterns
| Language | Mechanism |
|----------|-----------|
| Python | `client.get_paginator("operation")` |
| Node.js | Helper paginators or manual `NextToken` loops |
| Java | `.nextToken()` usage in loop |
| .NET | `NextToken` loop manually |

Always guard against infinite loops (break on null token). Avoid loading entire result sets into memory.

---

## 4. Waiters & State Polling
Use service-provided waiters:
- Python: `client.get_waiter("object_exists")`
- Java: `waiter.waitUntilX`
- Node.js: `waitUntilX`
- .NET: Sometimes manual loops (a few built-in waiters)

Fallback pattern (pseudo):
```
while not_done and attempts < max:
  status = describe()
  if status in success: break
  if status in failure: raise
  sleep(backoff)
```

---

## 5. Retry Modes & Backoff
| Mode | Description |
|------|-------------|
| Standard | Exponential backoff w/ jitter |
| Adaptive (Python/JS) | Adds client-side throttling |
| Custom | Provide custom strategy (JS/Java) |

Tune `max_attempts` based on service SLAs & latency tolerance.

---

## 6. Timeouts & Resilience
- Set connect & read timeouts (Python botocore config / Java HTTP client builder / Node HTTP handler).
- Combine with circuit breakers when high failure rates.
- Distinguish between *retryable* vs *non-retryable* errors.

---

## 7. Logging & Observability
- Include request IDs (`ResponseMetadata.RequestId` or service-specific IDs) in application logs.
- Structured JSON logging for ingestion into log analytics.
- Trace propagation with OpenTelemetry: instrument the HTTP layer or use ADOT.

---

## 8. Testing & Local Development
| Tool | Purpose |
|------|---------|
| LocalStack | Multi-service local environment |
| moto (Python) | Mock AWS services |
| WireMock / Nock | HTTP-level simulation |
| aws-sdk-client-mock (JS) | Mock modular clients |
| TestContainers (Java) | Containerized test dependencies |

Avoid relying on live AWS for unit tests; reserve integration tests for critical flows with constrained test accounts.

---

## 9. Common Errors (Mapping)
| Error Type | Typical Code | Meaning | Action |
|------------|--------------|---------|--------|
| Auth | `UnrecognizedClientException` | Invalid credentials | Refresh/rotate |
| Auth | `AccessDenied` | Missing permission | Adjust IAM policy |
| Rate | `ThrottlingException` / `RequestLimitExceeded` | API limit exceeded | Backoff & optimize |
| NotFound | `ResourceNotFoundException` | Resource absent | Validate IDs / order of operations |
| Conflict | `ResourceInUseException` | Resource locked | Retry after delay |
| Validation | `ValidationException` | Malformed input | Correct parameters |
| Expired | `ExpiredToken` | STS credentials expired | Re-assume role |

---

## 10. Universal Best Practices
- Reuse SDK clients.
- Prefer least privilege IAM roles with narrow resource ARNs.
- Use tagging for traceability (project, environment).
- Avoid synchronous blocking on async APIs.
- Externalize configuration (env vars, Parameter Store).
- Paginate & stream where possible (avoid loading large lists).
- Validate inputs before AWS calls (fail fast).
- Implement idempotent provisioning (detect existing resources).
- Secure secret material—never log or commit.

---

## 11. Security Checklist
- [ ] No static long-lived keys in code.
- [ ] MFA enforced for human IAM users.
- [ ] Roles used for workloads (EC2/ECS/Lambda/EKS).
- [ ] Rotate keys (if any) ≤ 90 days.
- [ ] Encrypt sensitive data at rest & in transit.
- [ ] Apply resource-level conditions where feasible.
- [ ] Use IAM Access Analyzer to detect broad policies.

---
