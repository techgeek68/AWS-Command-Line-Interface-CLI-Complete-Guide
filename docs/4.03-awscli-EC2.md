# AWS CLI â€” EC2 Instance Lifecycle & Queries

> Note: When running commands or instructions in PowerShell, do not forget to use aws.exe

**Launch instance**
Syntax:
```bash
aws ec2 run-instances \
  --image-id <AMI_ID> \
  --instance-type t3.micro \
  --key-name <KEY_PAIR_NAME> \
  --security-group-ids <SECURITY_GROUP_ID> \
  --subnet-id <SUBNET_ID> \
  --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=<TAG_VALUE>}]}]'
```
Examples:

Linux/Unix:
```bash
aws ec2 run-instances \
  --image-id ami-0fd3ac4abb734302a \
  --instance-type t2.micro \
  --key-name vockey \
  --security-group-ids sg-0f9a97b1f6ae93ec9 \
  --subnet-id subnet-0a334a0a47e57bdd8 \
  --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=MyInstance}]'
```

PowerShell:
```powershell
aws ec2 run-instances --image-id ami-0fd3ac4abb734302a --instance-type t2.micro --key-name vockey --security-group-ids sg-0f9a97b1f6ae93ec9 --subnet-id subnet-0a334a0a47e57bdd8 --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=MyInstance}]'
```
or
```powershell
aws ec2 run-instances `
  --image-id ami-0fd3ac4abb734302a `
  --instance-type t2.micro `
  --key-name vockey `
  --security-group-ids sg-0f9a97b1f6ae93ec9 `
  --subnet-id subnet-0a334a0a47e57bdd8 `
  --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=MyInstance}]'
```

**List instances (table)**

Linux/Unix:
Example:
```bash
  aws ec2 describe-instances --query 'Reservations[].Instances[].[InstanceId,State.Name,Tags[?Key==`Name`].Value|[0]]' --output table
```

PowerShell:
Example:
```powershell
  aws.exe ec2 describe-instances --query 'Reservations[].Instances[].[InstanceId,State.Name,Tags[?Key==`Name`].Value|[0]]' --output table
```

**Stop instance**

Syntax:
```bash
  aws ec2 stop-instances --instance-ids <INSTANCE_ID>
```

**Start instance**

Syntax:
```bash
  aws ec2 start-instances --instance-ids <INSTANCE_ID>
```

**Terminate instance**

Syntax:
```bash
  aws ec2 terminate-instances --instance-ids <INSTANCE_ID>
```

**Wait for running**

Syntax:
```bash
  aws ec2 wait instance-running --instance-ids <INSTANCE_ID>
```

**Get public DNS**

Syntax:
```bash
  aws ec2 describe-instances --instance-ids <INSTANCE_ID> --query 'Reservations[0].Instances[0].PublicDnsName' --output text
```

**SSH connect**
```bash
  ssh -i <KEY_FILE>.pem ec2-user@<PUBLIC_DNS>
```

---
**Queries & Filters**

**List regions**

Syntax:
```bash
  aws ec2 describe-regions --output table
```

**Filter by tag**

Syntax:
```bash
  aws ec2 describe-instances --filters "Name=tag:Environment,Values=<TAG_VALUE>" --query 'Reservations[].Instances[].InstanceId' --output text
```

**Instance type offerings**

Example:
```bash
  aws ec2 describe-instance-type-offerings --location-type availability-zone --filters Name=instance-type,Values=t3.micro --query 'InstanceTypeOfferings[].Location' --output table
```
---
**Debug**

**Debug describe**

Example:
```bash
  aws ec2 describe-instances --debug
```
---
