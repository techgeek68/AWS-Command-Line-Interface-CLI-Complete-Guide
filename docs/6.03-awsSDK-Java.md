# AWS SDK Developer Guide â€” Java (SDK v2)

Focus: Dependency setup (Maven/Gradle), region & credentials, sync vs async clients, pagination, waiters, retries, example (list regions).

## Table of Contents
1. Overview
2. Prerequisites
3. Dependency Management
4. Creating Clients
5. Credentials & Regions
6. Example: List Regions
7. Pagination
8. Waiters
9. Retries & Timeouts
10. Logging & Instrumentation
11. Testing
12. Common Errors
13. Best Practices

---

## 1. Overview
AWS SDK for Java v2 is modular, uses immutable clients, supports async (Netty) and sync (Apache HTTP) transports, and includes advanced configuration via builders.

---

## 2. Prerequisites
- Java 11+ (LTS preferred).
- Maven or Gradle.
- Credentials via environment, shared config, or instance roles.

---

## 3. Dependency Management

### Maven (pom.xml snippet)
```xml
<dependency>
  <groupId>software.amazon.awssdk</groupId>
  <artifactId>ec2</artifactId>
  <version>2.25.20</version>
</dependency>
```

### Gradle (Kotlin DSL)
```kotlin
implementation("software.amazon.awssdk:ec2:2.25.20")
```

---

## 4. Creating Clients
```java
Ec2Client ec2 = Ec2Client.builder()
    .region(Region.US_EAST_1)
    .build();
```
Async:
```java
Ec2AsyncClient asyncEc2 = Ec2AsyncClient.builder()
    .region(Region.US_EAST_1)
    .build();
```

---

## 5. Credentials & Regions
Resolution chain:
1. Environment (`AWS_ACCESS_KEY_ID`)
2. Java system props
3. Profile (`~/.aws/credentials`)
4. Web identity / SSO
5. EC2 / ECS metadata

Custom:
```java
Ec2Client ec2 = Ec2Client.builder()
  .region(Region.of("us-west-2"))
  .credentialsProvider(ProfileCredentialsProvider.create("dev"))
  .build();
```

---

## 6. Example: List Regions
See `ListRegions.java`.

Compile/Run (Maven):
```bash
mvn -q exec:java -Dexec.mainClass=ListRegions
```

---

## 7. Pagination
List APIs that paginate supply a `nextToken` (or similar). Use loop:
```java
String token = null;
do {
  var resp = ec2.describeInstances(r -> r.nextToken(token));
  // process resp.reservations()
  token = resp.nextToken();
} while (token != null);
```

---

## 8. Waiters
```java
var waiter = ec2.waiter();
var response = waiter.waitUntilInstanceRunning(r -> r.instanceIds("i-1234567890abcdef0"));
```

---

## 9. Retries & Timeouts
Default: standard retries. Custom:
```java
Ec2Client client = Ec2Client.builder()
  .overrideConfiguration(cfg -> cfg
    .retryPolicy(RetryPolicy.defaultRetryPolicy())
  )
  .build();
```
HTTP timeouts:
```java
HttpClientBuilder builder = ApacheHttpClient.builder()
  .socketTimeout(Duration.ofSeconds(60))
  .connectionTimeout(Duration.ofSeconds(10));
```

---

## 10. Logging & Instrumentation
Enable SDK wire logging (SLF4J):
```properties
# logback.xml / logging config
logger.name=software.amazon.awssdk
level=INFO
```
Tracing: integrate with OpenTelemetry instrumentation for JVM.

---

## 11. Testing
| Tool | Purpose |
|------|---------|
| JUnit / TestNG | Unit tests |
| WireMock | HTTP mocks |
| LocalStack | Integration tests |
| Mockito | Mocking credential providers |

Example (mock credential provider):
```java
StaticCredentialsProvider.create(AwsBasicCredentials.create("AKIA...","SECRET"));
```

---

## 12. Common Errors
| Error | Cause | Fix |
|-------|-------|-----|
| `SdkClientException: Unable to load credentials` | No provider source | Configure profile/env |
| `UnrecognizedClientException` | Bad keys | Rotate or correct credentials |
| `ThrottlingException` | API limits | Add backoff or reduce concurrency |
| `Retry attempts exceeded` | Persistent failure | Investigate root cause, adjust max attempts |

---

## 13. Best Practices
- Reuse clients (thread-safe).
- Prefer async for high-concurrency I/O workloads.
- Use Waiters instead of manual sleep + poll loops.
- Configure timeouts & retries explicitly in latency-sensitive services.
- Externalize region and profile (e.g., env or config).
- Scrub secrets in logs; avoid enabling wire logs in production.

---
