# AWS CLI â€“ Lambda Guide

## Table of Contents
1. [Overview](#overview)
2. [Creating a Function](#1-creating-a-function)
3. [Updating Function Code](#2-updating-function-code)
4. [Invoking Functions](#3-invoking-functions)
5. [Versions & Aliases](#4-versions--aliases)
6. [Environment Variables](#5-environment-variables)
7. [Logs](#6-logs)
8. [Best Practices](#7-best-practices)
9. [Troubleshooting](#8-troubleshooting)

---

## Overview
AWS Lambda runs code without managing servers. The CLI lets you create functions, update code, configure environment variables, invoke, and list versions/aliases. For build & deploy pipelines you typically combine with packaging tools (zip, SAM, CDK).

---

## 1. Creating a Function
Handler (`lambda_function.py`):
```python
def handler(event, context):
    return {"statusCode": 200, "body": "Hello from CLI"}
```

Zip:
```bash
zip function.zip lambda_function.py
```

Create function:
```bash
aws lambda create-function \
  --function-name HelloCli \
  --runtime python3.11 \
  --handler lambda_function.handler \
  --zip-file fileb://function.zip \
  --role arn:aws:iam::123456789012:role/LambdaBasicExecutionRole
```

List:
```bash
aws lambda list-functions
```

---

## 2. Updating Function Code
```bash
zip function.zip lambda_function.py
aws lambda update-function-code \
  --function-name HelloCli \
  --zip-file fileb://function.zip
aws lambda wait function-updated --function-name HelloCli
```

---

## 3. Invoking Functions
Invoke:
```bash
aws lambda invoke \
  --function-name HelloCli \
  --payload '{"message":"test"}' \
  response.json
```

Log inline:
```bash
aws lambda invoke --function-name HelloCli --log-type Tail response.json \
  --query 'LogResult' --output text | base64 --decode
```

---

## 4. Versions & Aliases
Publish:
```bash
aws lambda publish-version --function-name HelloCli
```

Create alias:
```bash
aws lambda create-alias \
  --function-name HelloCli \
  --name prod \
  --function-version 3
```

Update alias:
```bash
aws lambda update-alias \
  --function-name HelloCli \
  --name prod \
  --function-version 4
```

---

## 5. Environment Variables
Update:
```bash
aws lambda update-function-configuration \
  --function-name HelloCli \
  --environment "Variables={STAGE=dev,LOG_LEVEL=info}"
```

Get:
```bash
aws lambda get-function-configuration --function-name HelloCli
```

---

## 6. Logs
Tail:
```bash
aws logs tail /aws/lambda/HelloCli --since 5m
```

---

## 7. Best Practices
- Least privilege execution role.
- Use layers for shared dependencies.
- Externalize config via env vars / Parameter Store / Secrets Manager.
- Use versions + aliases for deployment safety.
- Monitor concurrency; set reserved concurrency where needed.
- Employ structured (JSON) logging.

---

## 8. Troubleshooting
| Issue | Cause | Fix |
|-------|-------|-----|
| Handler not found | Wrong handler string | Align `file.function` |
| Timeout | Default too low | Increase `--timeout` |
| AccessDenied | Missing IAM perms | Attach needed policy |
| Large package | Size limit exceeded | Use S3 or layers |
| Throttling | Concurrency cap | Increase or optimize |

Recent logs:
```bash
aws logs tail /aws/lambda/HelloCli --since 5m
```

---
